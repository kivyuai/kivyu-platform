<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Niche Manager - Kivyu</title>
<link rel="stylesheet" href="static/shared.css">
<style>
.niches-page{min-height:100vh;padding:calc(var(--nav-h) + 40px) 40px 80px}
.niches-inner{max-width:1100px;margin:0 auto}
.page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:36px}
.page-header h1{font-size:1.8rem;font-weight:600}
.page-header p{color:var(--muted2);margin-top:6px;font-size:.9rem}
.btn-add-niche{background:linear-gradient(135deg,var(--blue2),var(--violet));color:#fff;border:none;padding:12px 24px;border-radius:10px;font-weight:600;cursor:pointer;font-size:.9rem;transition:.2s}
.btn-add-niche:hover{opacity:.85;transform:translateY(-1px)}
.niches-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:20px;margin-bottom:32px}
.niche-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:24px;backdrop-filter:blur(8px);position:relative;transition:.2s}
.niche-card:hover{border-color:rgba(99,102,241,.4)}
.niche-card-header{display:flex;align-items:center;gap:12px;margin-bottom:20px}
.niche-emoji-btn{width:44px;height:44px;border-radius:10px;background:rgba(99,102,241,.15);border:1px solid rgba(99,102,241,.3);display:flex;align-items:center;justify-content:center;font-size:1.4rem;cursor:pointer;transition:.2s}
.niche-emoji-btn:hover{background:rgba(99,102,241,.3)}
.niche-name-input{flex:1;background:transparent;border:none;border-bottom:1px solid var(--border);color:var(--text);font-size:1.1rem;font-weight:600;padding:4px 0;outline:none;font-family:var(--ff-body)}
.niche-name-input:focus{border-bottom-color:var(--blue2)}
.niche-delete{position:absolute;top:16px;right:16px;width:28px;height:28px;border-radius:6px;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2);color:#ef4444;font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s;line-height:1}
.niche-delete:hover{background:rgba(239,68,68,.25)}
.field-row{margin-bottom:14px}
.field-label{font-size:.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:.07em;margin-bottom:6px}
.field-input{width:100%;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:9px 12px;font-size:.85rem;font-family:var(--ff-body);outline:none;transition:.2s;box-sizing:border-box}
.field-input:focus{border-color:var(--blue2)}
.field-select{width:100%;background:rgba(20,20,35,.9);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:9px 12px;font-size:.85rem;font-family:var(--ff-body);outline:none;cursor:pointer}
.field-textarea{width:100%;background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:9px 12px;font-size:.82rem;font-family:var(--ff-body);outline:none;resize:vertical;min-height:80px;transition:.2s;box-sizing:border-box}
.field-textarea:focus{border-color:var(--blue2)}
.niche-platforms{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.platform-tag{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:100px;font-size:.75rem;font-weight:600;cursor:pointer;border:1px solid transparent;transition:.2s;user-select:none}
.platform-tag.active{background:rgba(99,102,241,.2);border-color:rgba(99,102,241,.4);color:var(--blue2)}
.platform-tag:not(.active){background:rgba(255,255,255,.04);border-color:var(--border);color:var(--muted)}
.niche-save-btn{width:100%;margin-top:16px;padding:10px;background:rgba(99,102,241,.15);border:1px solid rgba(99,102,241,.3);border-radius:8px;color:var(--blue2);font-weight:600;font-size:.85rem;cursor:pointer;transition:.2s}
.niche-save-btn:hover{background:rgba(99,102,241,.3)}
.niche-saved-badge{display:none;position:absolute;bottom:12px;right:12px;font-size:.7rem;color:var(--teal);font-weight:600}
.empty-state{text-align:center;padding:80px 40px;color:var(--muted)}
.empty-state .empty-icon{font-size:3rem;margin-bottom:16px}
.empty-state h3{font-size:1.2rem;font-weight:600;margin-bottom:8px;color:var(--text)}
.emoji-picker{position:absolute;top:72px;left:24px;background:#1a1a2e;border:1px solid var(--border);border-radius:12px;padding:12px;display:grid;grid-template-columns:repeat(6,1fr);gap:4px;z-index:100;box-shadow:0 8px 32px rgba(0,0,0,.5)}
.emoji-opt{font-size:1.3rem;padding:6px;border-radius:6px;cursor:pointer;text-align:center;transition:.1s}
.emoji-opt:hover{background:rgba(255,255,255,.1)}
.stats-bar{display:flex;gap:24px;margin-bottom:32px;padding:20px 24px;background:var(--surface);border:1px solid var(--border);border-radius:14px}
.stat-item{text-align:center}
.stat-num{font-family:var(--ff-cond);font-size:1.8rem;font-weight:900;background:linear-gradient(135deg,var(--blue2),var(--violet));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.stat-lbl{font-size:.72rem;color:var(--muted);text-transform:uppercase;letter-spacing:.06em}
</style>
</head>
<body>
<div id="kv-nav-placeholder"></div>
<div id="kv-toast" class="kv-toast"></div>
<div class="niches-page">
<div class="aurora-blob" style="top:5%;right:10%;width:500px;height:500px;opacity:.5"></div>
<div class="niches-inner">

<div class="page-header reveal">
<div>
<h1>Niche Manager</h1>
<p>Create and customise unlimited content niches with unique prompts and styles</p>
</div>
<button class="btn-add-niche" onclick="addNiche()">+ Add New Niche</button>
</div>

<div class="stats-bar reveal reveal-d1" id="stats-bar">
<div class="stat-item"><div class="stat-num" id="stat-count">0</div><div class="stat-lbl">Niches</div></div>
<div class="stat-item"><div class="stat-num" id="stat-platforms">0</div><div class="stat-lbl">Platforms</div></div>
<div class="stat-item"><div class="stat-num" id="stat-videos">0</div><div class="stat-lbl">Videos Made</div></div>
</div>

<div class="niches-grid reveal reveal-d2" id="niches-grid"></div>

<div id="empty-state" class="empty-state" style="display:none">
<div class="empty-icon">üìÅ</div>
<h3>No niches yet</h3>
<p>Add your first niche to start organising your content strategy</p>
<button class="btn-add-niche" style="margin-top:20px" onclick="addNiche()">+ Create First Niche</button>
</div>

</div>
</div>

<script src="static/nav.js"></script>
<script>
var EMOJIS = ['üéÆ','üíª','üç≥','‚úàÔ∏è','üí∞','üí™','üíÑ','üì±','üéì','üéµ','üåø','üßò','üè†','üêæ','üé®','üì∏','üé¨','üåç','‚öΩ','üî¨','üõí','üéØ','üöÄ','üåü'];
var PLATFORMS = ['YouTube','TikTok','Instagram','Facebook','Twitter','Snapchat'];
var STYLES = ['Cinematic','Fast-paced','Tutorial','Vlog','Documentary','ASMR','Explainer','Review'];

function getNiches() {
  try { return JSON.parse(localStorage.getItem('kv_niches') || '[]'); } catch(e) { return []; }
}
function saveNiches(arr) {
  localStorage.setItem('kv_niches', JSON.stringify(arr));
}
function getVideos() {
  try { return JSON.parse(localStorage.getItem('kv_videos') || '[]'); } catch(e) { return []; }
}

function updateStats() {
  var niches = getNiches();
  var videos = getVideos();
  document.getElementById('stat-count').textContent = niches.length;
  var pSet = {};
  niches.forEach(function(n) { (n.platforms || []).forEach(function(p) { pSet[p] = 1; }); });
  document.getElementById('stat-platforms').textContent = Object.keys(pSet).length;
  document.getElementById('stat-videos').textContent = videos.length;
}

function renderNiches() {
  var niches = getNiches();
  var grid = document.getElementById('niches-grid');
  var empty = document.getElementById('empty-state');
  if (niches.length === 0) {
    grid.innerHTML = '';
    empty.style.display = 'block';
    updateStats();
    return;
  }
  empty.style.display = 'none';
  grid.innerHTML = niches.map(function(n, i) { return buildCard(n, i); }).join('');
  updateStats();
}

function buildCard(n, i) {
  var platformsHTML = PLATFORMS.map(function(p) {
    var active = (n.platforms || []).indexOf(p) > -1 ? 'active' : '';
    return '<span class="platform-tag ' + active + '" onclick="togglePlatform(' + i + ','' + p + '',this)">' + p + '</span>';
  }).join('');
  var styleOpts = STYLES.map(function(s) {
    return '<option value="' + s + '"' + (n.style === s ? ' selected' : '') + '>' + s + '</option>';
  }).join('');
  return '<div class="niche-card" id="nc-' + i + '">' +
    '<button class="niche-delete" onclick="deleteNiche(' + i + ')">&#215;</button>' +
    '<div class="niche-card-header">' +
    '<button class="niche-emoji-btn" onclick="openEmojiPicker(' + i + ')" id="emoji-btn-' + i + '">' + (n.emoji || 'üéØ') + '</button>' +
    '<input class="niche-name-input" type="text" value="' + escHtml(n.name || '') + '" placeholder="Niche name..." onchange="updateField(' + i + ','name',this.value)" />' +
    '</div>' +
    '<div class="field-row"><div class="field-label">Platforms</div><div class="niche-platforms">' + platformsHTML + '</div></div>' +
    '<div class="field-row"><div class="field-label">Video Style</div>' +
    '<select class="field-select" onchange="updateField(' + i + ','style',this.value)">' + styleOpts + '</select>' +
    '</div>' +
    '<div class="field-row"><div class="field-label">Default Prompt Template</div>' +
    '<textarea class="field-textarea" placeholder="Cinematic 4K footage of {topic}..." onchange="updateField(' + i + ','prompt',this.value)">' + escHtml(n.prompt || '') + '</textarea>' +
    '</div>' +
    '<div class="field-row"><div class="field-label">Brand Colour</div>' +
    '<input type="color" value="' + (n.color || '#6366f1') + '" onchange="updateField(' + i + ','color',this.value)" style="width:100%;height:36px;border-radius:8px;border:1px solid var(--border);background:transparent;cursor:pointer;padding:2px">' +
    '</div>' +
    '<button class="niche-save-btn" onclick="saveNiche(' + i + ')">Save Niche</button>' +
    '<div class="niche-saved-badge" id="saved-' + i + '">Saved ‚úì</div>' +
    '</div>';
}

function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function addNiche() {
  var niches = getNiches();
  niches.push({ name: '', emoji: EMOJIS[niches.length % EMOJIS.length], platforms: ['YouTube'], style: 'Cinematic', prompt: '', color: '#6366f1' });
  saveNiches(niches);
  renderNiches();
  var grid = document.getElementById('niches-grid');
  if (grid.lastElementChild) grid.lastElementChild.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function deleteNiche(i) {
  var niches = getNiches();
  niches.splice(i, 1);
  saveNiches(niches);
  renderNiches();
  if (window.kvToast) kvToast('Niche removed', 'info');
}

function updateField(i, field, val) {
  var niches = getNiches();
  if (niches[i]) { niches[i][field] = val; saveNiches(niches); }
}

function togglePlatform(i, platform, el) {
  var niches = getNiches();
  if (!niches[i]) return;
  var plats = niches[i].platforms || [];
  var idx = plats.indexOf(platform);
  if (idx > -1) { plats.splice(idx, 1); el.classList.remove('active'); }
  else { plats.push(platform); el.classList.add('active'); }
  niches[i].platforms = plats;
  saveNiches(niches);
}

function saveNiche(i) {
  var card = document.getElementById('nc-' + i);
  if (card) {
    var nameEl = card.querySelector('.niche-name-input');
    var promptEl = card.querySelector('.field-textarea');
    if (nameEl) updateField(i, 'name', nameEl.value);
    if (promptEl) updateField(i, 'prompt', promptEl.value);
  }
  var badge = document.getElementById('saved-' + i);
  if (badge) { badge.style.display = 'block'; setTimeout(function() { badge.style.display = 'none'; }, 2000); }
  if (window.kvToast) kvToast('Niche saved!', 'success');
  updateStats();
}

function openEmojiPicker(i) {
  document.querySelectorAll('.emoji-picker').forEach(function(p) { p.remove(); });
  var btn = document.getElementById('emoji-btn-' + i);
  if (!btn) return;
  var picker = document.createElement('div');
  picker.className = 'emoji-picker';
  EMOJIS.forEach(function(e) {
    var opt = document.createElement('div');
    opt.className = 'emoji-opt';
    opt.textContent = e;
    opt.onclick = function() {
      btn.textContent = e;
      updateField(i, 'emoji', e);
      picker.remove();
    };
    picker.appendChild(opt);
  });
  btn.parentElement.parentElement.appendChild(picker);
  document.addEventListener('click', function handler(ev) {
    if (!picker.contains(ev.target) && ev.target !== btn) { picker.remove(); document.removeEventListener('click', handler); }
  }, true);
}

// Load default niches if first time
function maybeLoadDefaults() {
  var niches = getNiches();
  if (niches.length === 0) {
    var defaults = [
      { name: 'Gaming', emoji: 'üéÆ', platforms: ['YouTube','TikTok'], style: 'Fast-paced', prompt: 'Cinematic 4K gaming footage of {topic}, epic moments, smooth transitions, professional broadcast quality', color: '#8b5cf6' },
      { name: 'Tech Reviews', emoji: 'üíª', platforms: ['YouTube'], style: 'Review', prompt: '4K tech review of {topic}, clean studio lighting, minimal aesthetic, professional presenter', color: '#3b82f6' },
      { name: 'Lifestyle', emoji: 'üåü', platforms: ['YouTube','Instagram','TikTok'], style: 'Vlog', prompt: 'Cinematic vlog of {topic}, golden hour lighting, warm tones, authentic lifestyle footage', color: '#f59e0b' }
    ];
    saveNiches(defaults);
  }
}

maybeLoadDefaults();
renderNiches();
</script>
</body>
</html>
